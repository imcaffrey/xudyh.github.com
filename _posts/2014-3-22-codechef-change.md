---
layout: post
title: "Codechef CHANGE"
category: "solution"
tags: ["solution"]
---
{% include JB/setup %}

这是我认为CC上挺不错的题之一。其他的还有WINDOW,QPOLYSUM。我觉得强烈推荐这三个题。

这个是聊天记录里面copy出来的。。。

听说支持数学公式了

$$a!+b !=b!+a!$$

1/ Prod(1-x^pi)= A(x)/(1-x)^n + sigma Bi(x)/ (1+x+..+x^(pi-1))

如果我们知道了B。。。那么可以用dp搞出方案数，然后减去B的贡献，插值求A就行了。。。

然后两边乘上 (1+x+...+x^(pi-1))，式子就变成

1/ (1-x)(1-x^p1)....(1-x^p_{i-1})(1-x^p_{i+1})...(1-x^pn)=(1+x+..+x^(pi-1)) \* C+ Bi(x) ,其他的项都有 (1+x+..+x^(pi-1))这个因子

将pi-1个个复根代入。。。

然后dft能搞出右边的Bi了。。。

当然不能直接这样搞。。。

注意1/(1-w_n)肯定能用w_n的0到n-2次表示

然后w_n^0,w_n^1,...,w_n^(n-2)是不“线性相关”的。。。

所以如果将w_n代入，左边是 a0\*w_n^0+ a1\*w_n^1+...+a_{n-2}\*w_n^{n-2}，那么Bi(x)=a0\*x^0+ a1\*x^1+...+a_{n-2}\*x^{n-2}

如果你觉得这样不靠谱我记得直接dft推也是这个结果

然后如果直接展左边的那么就是n个次数为D的多项式，卷积暴力是nD^2，然后做n次是n^2D^2的。。。

这个是会T的。。。

然后我记得找了个规律那个卷积就变nD，然后总复杂度就是n^2D了。。。

比如令 n=5

	     S= 1+2w+3w^2+4w^3+5w^4
	
	    wS=    w+2w^2+3w^3+4w^4+5

	(1-w)S= 1+w+w^2+w^3+w^4-5=-5
所以1/(1-w_n)= (-sigma{i=0}^{n-1} i\*w_n^i)/n?

所以1/(1-w_n^k)= (-sigma{i=0}^{n-1} i\*w_n^{ik})/n?

然后一个正常的多项式怎么和这个不正常的多项式愉快的卷积呢？

为了方便。。。就不把w_n^{n-1}搞掉了。。。

然后我们开始愉快的乱搞。。。

假设k=1

那么比如做

	a b c d 和
	
	0 1 2 3的卷积
	
	首先是3a+2b+c
	
	然后就是向右shift一位
	
	a b c d 和
	
	3 0 1 2的卷积
	
	2a+b+3d。。。显然是-(a+b+c+d)+4*d
	
然后卷积就能在O(d)内算出来了。。。

然后如果k!=1的话巧妙的调整一下就可以了。。。还是能这么搞

然后就解决了。。。

为什么还是这样直接打公式呢，因为懒嘛。。。
